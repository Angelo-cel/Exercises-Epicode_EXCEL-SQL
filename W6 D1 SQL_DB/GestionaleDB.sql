-- creazione database
CREATE DATABASE  Gestionale;

USE Gestionale;

DROP TABLE PRODOTTI;
CREATE TABLE PRODOTTI (
ID_PRODOTTO INT,
NOME_PRODOTTO VARCHAR(100),
PREZZO DECIMAL(10,2),
PRIMARY KEY (ID_PRODOTTO));


INSERT INTO Prodotti (ID_PRODOTTO, NOME_PRODOTTO, PREZZO) VALUES
(1, 'Tablet', 300.00),
(2, 'Mouse', 20.00),
(3, 'Tastiera', 25.00),
(4, 'Monitor', 180.00),
(5, 'HDD', 90.00),
(6, 'SSD', 200.00),
(7, 'RAM', 100.00),
(8, 'Router', 80.00),
(9, 'Webcam', 45.00),
(10, 'GPU', 1250.00),
(11, 'Trackpad', 500.00),
(12, 'Techmagazine', 5.00),
(13, 'Martech', 50.00);

DROP TABLE CLIENTI;
CREATE TABLE CLIENTI (
ID_CLIENTE INT,
NOME VARCHAR(50),
EMAIL VARCHAR(100),
PRIMARY KEY (ID_CLIENTE));


INSERT INTO CLIENTI (ID_CLIENTE, NOME, EMAIL) VALUES
(1, 'Antonio', NULL),
(2, 'Battista' , 'battista@mailmail.it'),
(3, 'Maria' , 'maria@posta.it'),
(4, 'Franca' , 'franca@lettere.it'),
(5, 'Ettore' , NULL),
(6, 'Arianna' , 'arianna@posta.it'), 
(7, 'Piero' , 'piero@lavoro.it');

DROP TABLE ORDINI;
CREATE TABLE ORDINI (
ID_ORDINE INT PRIMARY KEY AUTO_INCREMENT,
ID_PRODOTTO INT,
ID_CLIENTE INT,
QUANTITÀ INT,
FOREIGN KEY (ID_PRODOTTO) REFERENCES PRODOTTI (ID_PRODOTTO),
FOREIGN KEY (ID_CLIENTE) REFERENCES CLIENTI (ID_CLIENTE));


INSERT INTO ORDINI (ID_PRODOTTO, ID_CLIENTE, QUANTITÀ) VALUES
(2, 1, 10),
(6, 2, 2),
(5, 3, 3),
(1, 4, 1),
(9, 5, 1),
(4, 5, 2),
(11, 6, 6),
(10, 7, 2),
(3, 4, 3),
(3, 2, 1),
(2, 1, 1);


CREATE TABLE DETTAGLIO_ORDINI (
ID_ORDINE INT,
ID_PRODOTTO INT,
ID_CLIENTE INT,
PREZZO_TOTALE DECIMAL (10, 2),
PRIMARY KEY (ID_ORDINE, ID_PRODOTTO, ID_CLIENTE),
FOREIGN KEY (ID_ORDINE) REFERENCES ORDINI (ID_ORDINE),
FOREIGN KEY (ID_PRODOTTO) REFERENCES PRODOTTI (ID_PRODOTTO),
FOREIGN KEY (ID_CLIENTE) REFERENCES CLIENTI (ID_CLIENTE));


INSERT INTO DETTAGLIO_ORDINI (ID_ORDINE, ID_PRODOTTO, ID_CLIENTE, PREZZO_TOTALE) SELECT
ORD.ID_ORDINE,
ORD.ID_PRODOTTO,
ORD.ID_CLIENTE,
PRD.PREZZO * ORD.QUANTITÀ AS PREZZO_TOTALE
FROM ORDINI ORD JOIN PRODOTTI PRD ON ORD.ID_PRODOTTO = PRD.ID_PRODOTTO

